# å•ä½“åº”ç”¨è½¯éš”ç¦»

ä¸ç¡¬éš”ç¦»ç›¸å¯¹çš„ï¼Œç¬”è€…ç§°ä¸ºå•ä½“åº”ç”¨è½¯éš”ç¦»ï¼Œå…¶æ›´å¤šåœ°ä¾èµ–äºåº”ç”¨æ¡†æ¶æˆ–è€…å¼€å‘æ„å»ºæµç¨‹ï¼Œæ¥å®ç°å®¹é”™ä¸æ ·å¼ã€DOM ç­‰éš”ç¦»ã€‚å•ä½“åº”ç”¨è½¯éš”ç¦»åˆå¯ä»¥ä»åº”ç”¨çš„ç»„åˆæ—¶æœºä¸æŠ€æœ¯æ ˆçš„æ”¯æŒæƒ…å†µè¿™ä¸¤ä¸ªç»´åº¦ï¼Œåˆ’åˆ†ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äºéœ€è¦æ”¯æŒä¸åŒæŠ€æœ¯æ ˆ(React, Angular, Vue.js, etc.)çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å½»åº•çš„ç±»åç«¯å¾®æœåŠ¡åŒ–ï¼Œæ¯ä¸ªå‰ç«¯åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„æœåŠ¡åŒ–åº”ç”¨ï¼Œè€Œå®¿ä¸»åº”ç”¨åˆ™æä¾›ç»Ÿä¸€çš„åº”ç”¨ç®¡ç†å’Œå¯åŠ¨æœºåˆ¶ï¼›æ­¤æ—¶è‹¥éœ€è¦è§£å†³èµ„æºé‡å¤åŠ è½½ã€å†—ä½™çš„é—®é¢˜ï¼Œåˆ™éœ€è¦ä¾èµ–ç»Ÿä¸€æ„å»ºæˆ–è€…ç”±å®¿ä¸»åº”ç”¨æä¾›å…¬å…±ä¾èµ–åº“ï¼Œå­åº”ç”¨æ‰“åŒ…æ—¶ä»…æ‰“åŒ…è‡ªèº«æˆ–éå…¬ç”¨åº“ä»£ç ã€‚å¦‚æœæ˜¯ç›¸åŒæŠ€æœ¯æ ˆçš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„æ‡’åŠ è½½èƒ½åŠ›ï¼Œåœ¨å¼€å‘é˜¶æ®µä»¥æ¨¡å—åˆ’åˆ†ä¸ºå¾®åº”ç”¨è¿›è¡Œå¼€å‘ï¼Œæ„å»ºæ—¶ä»¥å•ä½“åº”ç”¨çš„å½¢å¼æ„å»ºï¼Œåœ¨è¿è¡Œæ—¶æ˜¯ä»¥åº”ç”¨æ¨¡å—çš„å½¢å¼å­˜åœ¨ã€‚

![image](https://user-images.githubusercontent.com/5803001/44003230-de68ac5c-9e81-11e8-81f5-8092f7a9b421.png)

> ğŸ“Œ æœ¬éƒ¨åˆ†ä¼šéšç€ç¬”è€…çš„å®è·µé€æ­¥å®Œå–„ä¸°å¯Œï¼Œå¯ä»¥ä¿æŒå…³æ³¨ [Web å¼€å‘å¯¼è®º](https://github.com/wx-chevalier/Web-Series) æˆ–è€… [Ueact](https://github.com/wx-chevalier/Ueact)ã€‚

## Application Composition | åº”ç”¨ç»„åˆ

å…¸å‹çš„åº”ç”¨ç»„åˆæ–¹å¼åˆ†ä¸ºæ„å»ºæ—¶(Build Time)ç»„åˆä¸è¿è¡Œæ—¶(Runtime)ç»„åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºå³æ˜¯å…¸å‹çš„æ„å»ºæ—¶ç»„åˆæ–¹æ¡ˆï¼š

> ğŸ— å›¾ç‰‡æºè‡ª [Building application in a "Microfrontends" way](https://parg.co/o32)

![image](https://user-images.githubusercontent.com/5803001/43635855-fa36c57c-9742-11e8-80b4-71eda09bb20b.png)

æ„å»ºæ—¶ç»„åˆçš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿè¿›è¡Œè¾ƒå¥½åœ°ä¾èµ–ç®¡ç†ï¼ŒæŠ½å–å…¬å…±æ¨¡å—ï¼Œå‡å°‘æœ€ç»ˆçš„åŒ…ä½“å¤§å°ï¼Œä¸è¿‡å…¶æœ€ç»ˆçš„äº§å‡ºä»æ˜¯å•ä½“åº”ç”¨ï¼Œå„ä¸ªåº”ç”¨æ¨¡å—æ— æ³•è¿›è¡Œç‹¬ç«‹éƒ¨ç½²ã€‚ä¸ä¹‹ç›¸å¯¹çš„ï¼Œè¿è¡Œæ—¶ç»„åˆèƒ½å¤Ÿä¿éšœçœŸæ­£åœ°ç‹¬ç«‹å¼€å‘ä¸ç‹¬ç«‹éƒ¨ç½²ï¼š

![image](https://user-images.githubusercontent.com/5803001/43637055-609be510-9746-11e8-9e67-da452dd08b74.png)

è¿è¡Œæ—¶ç»„åˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨ä½¿ç”¨ Tailor è¿™æ ·çš„å·¥å…·è¿›è¡ŒæœåŠ¡ç«¯ç»„åˆ(SSI)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ JSPM, SystemJS è¿™æ ·çš„åŠ¨æ€å¯¼å…¥å·¥å…·ï¼Œè¿›è¡Œå®¢æˆ·ç«¯ç»„åˆã€‚è¿è¡Œæ—¶ç»„åˆåŒæ—¶èƒ½æä¾›æŒ‰éœ€åŠ è½½çš„ç‰¹æ€§ï¼Œä¼˜åŒ–é¦–é¡µçš„åŠ è½½é€Ÿåº¦ã€‚ä¸è¿‡è¿è¡Œæ—¶ç»„åˆå¯èƒ½é‡å¤åŠ è½½ä¾èµ–é¡¹ï¼ˆé€šè¿‡æµè§ˆå™¨ç¼“å­˜æˆ– HTTP2 é€‚åº¦è§£å†³ï¼‰ï¼Œå¹¶ä¸”ä¸åŒäº iFrame çš„ç¡¬éš”ç¦»ï¼Œè¿è¡Œæ—¶ç»„åˆä»å¯èƒ½é¢ä¸´éš¾ä»¥é¢„æ–™çš„ç¬¬ä¸‰æ–¹ä¾èµ–å†²çªã€‚

React è¿™æ ·çš„å£°æ˜å¼ç»„ä»¶æ¡†æ¶ï¼Œå¤©ç„¶å°±æ”¯æŒåº”ç”¨çš„ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥æ¸²æŸ“é”šç‚¹ä»¥è¿›è¡Œåº”ç”¨ç»„åˆï¼Œä¹Ÿå¯ä»¥å°†ä¸åŒæ¡†æ¶çš„åº”ç”¨å°è£…ä¸º Web Componentsã€‚é¦–å…ˆæˆ‘ä»¬å¯ä»¥å°† React åº”ç”¨å®šä¹‰ä¸ºè‡ªå®šä¹‰å…ƒç´ ï¼š

> ğŸ“ å®Œæ•´ä»£ç å‚è€ƒ [fe-boilerplate/micro-frontend](https://github.com/wx-chevalier/fe-boilerplates)

```js
window.customElements.define(
  'react-app',
  class ReactApp extends HTMLElement {
    ...
    render() {
      render(<App title={this.title} />, this);
    }
    ...
  }
);
```

ç„¶ååœ¨å‰ç«¯ä¸­ç›´æ¥ä½¿ç”¨è¯¥è‡ªå®šä¹‰å…ƒç´ ï¼š

```html
<react-app title="React Separate Running App" />
```

åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæ¡†æ¶å°†è·¯ç”±æŒ‡å®šåˆ°å¯¹åº”çš„ç»„ä»¶æˆ–è€…å†…éƒ¨æœåŠ¡ä¸­ï¼›è€Œå¾®å‰ç«¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†åº”ç”¨å†…çš„ç»„ä»¶è°ƒç”¨å˜æˆäº†æ›´ç»†ç²’åº¦çš„åº”ç”¨é—´ç»„ä»¶è°ƒç”¨ï¼Œå³åŸå…ˆæˆ‘ä»¬åªæ˜¯å°†è·¯ç”±åˆ†å‘åˆ°åº”ç”¨çš„ç»„ä»¶æ‰§è¡Œï¼Œç°åœ¨åˆ™éœ€è¦æ ¹æ®è·¯ç”±æ¥æ‰¾åˆ°å¯¹åº”çš„åº”ç”¨ï¼Œå†ç”±åº”ç”¨åˆ†å‘åˆ°å¯¹åº”çš„ç»„ä»¶ä¸Šã€‚å…·ä½“çš„å®è·µä¸­ï¼Œå¯èƒ½å®¿ä¸»åº”ç”¨ä½¿ç”¨ Hash Router å·²ç»å ç”¨äº† Hash æ ‡è®°ä½ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸ºå­åº”ç”¨æä¾›ä¸“å±çš„æŸ¥è¯¢é”®ï¼Œæ¥è¿›è¡Œå­åº”ç”¨å†…è·³è½¬ã€‚

## åº”ç”¨éš”ç¦»ä¸æ²»ç†

åœ¨ React ä¸­å¯ä»¥ä½¿ç”¨ ErrorBoundaryï¼Œæ¥é™åˆ¶åº”ç”¨å´©æºƒçš„å½±å“ï¼›å¦‚æœæ˜¯è‡ªå®šä¹‰çš„åº”ç”¨åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥å®ç° Promise å®¹é”™æ–¹æ¡ˆã€‚Redux å¯ä»¥è€ƒè™‘åœ¨å®¿ä¸»åº”ç”¨åˆ›å»ºç»Ÿä¸€çš„ Storeï¼Œæ¯ä¸ªåº”ç”¨ä¸­æŒ‰ç…§å‘½åç©ºé—´åˆ’åˆ†ä½¿ç”¨å­çŠ¶æ€ç©ºé—´ï¼š

```js
const subConnect = (subAppName) => (mapStateToProps, mapDispatchToProps) =>
  connect(
    (state) => mapStateToProps({ ...state[subAppName] }, state),
    mapDispatchToProps
  );
```

å¯¹äº Action å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´å½¢å¼ï¼š

```js
`app/service-name/action`;
```

è€Œå¯¹äºåº”ç”¨æ²»ç†æ–¹é¢ï¼Œ[single-spa](https://single-spa.js.org/) æˆ–è€… [ueact-component](https://github.com/wx-chevalier/Ueact) éƒ½å®šä¹‰äº†è·¨æ¡†æ¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œè­¬å¦‚åœ¨ single-spa ä¸­ï¼Œå¯ä»¥å°† React ç”Ÿå‘½å‘¨æœŸå½’ä¸€åŒ–ï¼š

```js
const reactLifecycles = singleSpaReact({
  React,
  ReactDOM,
  rootComponent,
  domElementGetter: () => document.getElementById("main-content"),
});

export const bootstrap = [reactLifecycles.bootstrap];

export const mount = [reactLifecycles.mount];

export const unmount = [reactLifecycles.unmount];
```

ç„¶åå°†å…¶å¯¼å‡ºä¸ºå•ä¸€åº”ç”¨å¹¶ä¸”å¼‚æ­¥åŠ è½½ï¼š

```js
// src/index.js
import { registerApplication, start } from "single-spa";

registerApplication(
  // Name of our single-spa application
  "root",
  // Our loading function
  () => import("./root.app.js"),
  // Our activity function
  () => true
);

start();
```
