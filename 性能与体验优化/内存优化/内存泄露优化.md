# å†…å­˜åˆ†æä¸å†…å­˜æ³„æ¼å®šä½

æ— è®ºæ˜¯åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿã€æœåŠ¡ç«¯åº”ç”¨ç¨‹åºè¿˜æ˜¯ iOSã€Android åŸç”Ÿåº”ç”¨éƒ½ä¼šå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼ŒWeb åº”ç”¨è‡ªç„¶ä¹Ÿä¸å¯é¿å…åœ°å­˜åœ¨ç€ç±»ä¼¼çš„é—®é¢˜ã€‚è™½ç„¶å› ä¸ºç½‘é¡µå¾€å¾€éƒ½æ˜¯å³ç”¨å³èµ°ï¼Œè¾ƒå°‘åœ°å­˜åœ¨æŸä¸ªç½‘é¡µé•¿æœŸè¿è¡Œçš„é—®é¢˜ï¼Œå³ä½¿å­˜åœ¨å†…å­˜æ³„æ¼å¯èƒ½è¡¨ç°åœ°ä¹Ÿä¸æ˜æ˜¾ï¼›ä½†æ˜¯åœ¨æŸäº›æ•°æ®å±•ç¤ºå‹çš„ï¼Œéœ€è¦é•¿æœŸè¿è¡Œçš„é¡µé¢ä¸Šï¼Œå¦‚æœä¸åŠæ—¶è§£å†³å†…å­˜æ³„æ¼å¯èƒ½ä¼šå¯¼è‡´ç½‘é¡µå æ®è¿‡å¤§åœ°å†…å­˜ï¼Œä¸ä»…å½±å“é¡µé¢æ€§èƒ½ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒã€‚[å‰ç«¯æ¯å‘¨æ¸…å•](https://parg.co/UHG)æ¨èè¿‡çš„ [How JavaScript works](https://parg.co/bnw) å°±æ˜¯éå¸¸ä¸é”™åœ°ä»‹ç» JavaScript è¿è¡Œæœºåˆ¶çš„ç³»åˆ—æ–‡ç« ï¼Œå…¶ä¹Ÿå¯¹å†…å­˜ç®¡ç†ä¸å†…å­˜æ³„æ¼æœ‰è¿‡åˆ†æï¼Œæœ¬æ–‡éƒ¨åˆ†å›¾ç‰‡ä¸ç¤ºä¾‹ä»£ç å³æ¥è‡ªæ­¤ç³»åˆ—ã€‚

ç±»ä¼¼äº C è¿™æ ·çš„è¯­è¨€æä¾›äº† `malloc()` ä¸ `free()` è¿™æ ·çš„åº•å±‚å†…å­˜ç®¡ç†åŸå­æ“ä½œï¼Œå¼€å‘è€…éœ€è¦æ˜¾å¼æ‰‹åŠ¨åœ°è¿›è¡Œå†…å­˜çš„ç”³è¯·ä¸é‡Šæ”¾ï¼›è€Œ Java è¿™æ ·çš„è¯­è¨€åˆ™æ˜¯æä¾›äº†è‡ªåŠ¨åŒ–çš„å†…å­˜å›æ”¶æœºåˆ¶ï¼Œç¬”è€…åœ¨[åƒåœ¾å›æ”¶ç®—æ³•ä¸ JVM åƒåœ¾å›æ”¶å™¨ç»¼è¿°](https://parg.co/UcF)ä¸€æ–‡ä¸­æœ‰è¿‡ä»‹ç»ã€‚JavaScript ä¹Ÿæ˜¯é‡‡ç”¨çš„è‡ªåŠ¨åŒ–å†…å­˜å›æ”¶æœºåˆ¶ï¼Œæ— è®ºæ˜¯ Objectã€String ç­‰éƒ½æ˜¯ç”±åƒåœ¾å›æ”¶è¿›ç¨‹è‡ªåŠ¨å›æ”¶å¤„ç†ã€‚è‡ªåŠ¨åŒ–å†…å­˜å›æ”¶å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å°±å¯ä»¥å¿½ç•¥å†…å­˜ç®¡ç†çš„ç›¸å…³æ“ä½œï¼Œåè€Œå¯èƒ½ä¼šå¯¼è‡´æ›´ä¸æ˜“å‘ç°çš„å†…å­˜æ³„æ¼å‡ºç°ã€‚

# å†…å­˜åˆ†é…ä¸å›æ”¶

ç¬”è€…åœ¨ [JavaScript Event Loop æœºåˆ¶è¯¦è§£ä¸ Vue.js ä¸­å®è·µåº”ç”¨](https://parg.co/Ucj)ä¸€æ–‡ä¸­ä»‹ç»è¿‡ JavaScript çš„å†…å­˜æ¨¡å‹ï¼Œå…¶ä¸»è¦ä¹Ÿæ˜¯ç”±å †ã€æ ˆã€é˜Ÿåˆ—ä¸‰æ–¹é¢ç»„æˆï¼š

![](https://github.com/wx-chevalier/OSS/raw/master/2017/8/1/1-ZSFHnq9iMHIApVLcgwczPQ.png?raw=true)

å…¶ä¸­é˜Ÿåˆ—æŒ‡çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€æ ˆå°±æ˜¯å‡½æ•°æ‰§è¡Œæ ˆï¼Œå…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

![JavaScript æ ˆæ¨¡å‹](https://coding.net/u/hoteam/p/Cache/git/raw/master/2017/10/1/1-W7L7JN5q4p7w2E7HbBYS3g.jpeg)

è€Œä¸»è¦çš„ç”¨æˆ·åˆ›å»ºçš„å¯¹è±¡å°±å­˜æ”¾åœ¨å †ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å†…å­˜åˆ†æä¸å†…å­˜æ³„æ¼å®šä½æ‰€éœ€è¦å…³æ³¨çš„ä¸»è¦çš„åŒºåŸŸã€‚æ‰€è°“å†…å­˜ï¼Œä»ç¡¬ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œå°±æ˜¯æ— æ•°è§¦å‘å™¨çš„ç»„åˆï¼›æ¯ä¸ªè§¦å‘å™¨èƒ½å¤Ÿå­˜æ”¾ 1 bit ä½çš„æ•°æ®ï¼Œä¸åŒçš„è§¦å‘å™¨ç”±å”¯ä¸€çš„æ ‡è¯†ç¬¦å®šä½ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è¯¥æ ‡è¯†ç¬¦è¯»å†™è¯¥è§¦å‘å™¨ã€‚æŠ½è±¡æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†…å­˜å½“åšæ¯”ç‰¹æ•°ç»„ï¼Œè€Œæ•°æ®å°±æ˜¯åœ¨å†…å­˜ä¸­é¡ºåºæ’å¸ƒï¼š

![1*W7L7JN5q4p7w2E7HbBYS3g](https://camo.githubusercontent.com/53847fa71f5bb05c52788adddb2d61efe847eecb/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a3561426f75346f6e6c314238786c67776f4754444f672e706e67)

JavaScript ä¸­å¼€å‘è€…å¹¶ä¸éœ€è¦æ‰‹åŠ¨åœ°ä¸ºå¯¹è±¡ç”³è¯·å†…å­˜ï¼Œåªéœ€è¦å£°æ˜å˜é‡ï¼ŒJavaScript Runtime å³å¯ä»¥è‡ªåŠ¨åœ°åˆ†é…å†…å­˜ï¼š

```js
var n = 374; // allocates memory for a number
var s = "sessionstack"; // allocates memory for a string
var o = {
  a: 1,
  b: null,
}; // allocates memory for an object and its contained values
var a = [1, null, "str"]; // (like object) allocates memory for the
// array and its contained values
function f(a) {
  return a + 3;
} // allocates a function (which is a callable object)
// function expressions also allocate an object
someElement.addEventListener(
  "click",
  function () {
    someElement.style.backgroundColor = "blue";
  },
  false
);
```

æŸä¸ªå¯¹è±¡çš„å†…å­˜ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºäº†å†…å­˜åˆ†é…ã€å†…å­˜ä½¿ç”¨ä¸å†…å­˜å›æ”¶è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œå½“æŸä¸ªå¯¹è±¡ä¸å†è¢«éœ€è¦æ—¶ï¼Œå®ƒå°±åº”è¯¥è¢«æ¸…é™¤å›æ”¶ï¼›æ‰€è°“çš„åƒåœ¾å›æ”¶å™¨ï¼ŒGarbage Collector å³æ˜¯è´Ÿè´£è¿½è¸ªå†…å­˜åˆ†é…æƒ…å†µã€åˆ¤æ–­æŸä¸ªè¢«åˆ†é…çš„å†…å­˜æ˜¯å¦æœ‰ç”¨ï¼Œå¹¶ä¸”è‡ªåŠ¨å›æ”¶æ— ç”¨çš„å†…å­˜ã€‚å¤§éƒ¨åˆ†çš„åƒåœ¾å›æ”¶å™¨æ˜¯æ ¹æ®å¼•ç”¨(Reference)æ¥åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œæ‰€è°“çš„å¼•ç”¨å³æ˜¯æŸä¸ªå¯¹è±¡æ˜¯å¦ä¾èµ–äºå…¶ä»–å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ä¾èµ–å…³ç³»å³å­˜åœ¨å¼•ç”¨ï¼›è­¬å¦‚æŸä¸ª JavaScript å¯¹è±¡å¼•ç”¨äº†å®ƒçš„åŸå‹å¯¹è±¡ã€‚æœ€ç®€å•çš„åƒåœ¾å›æ”¶ç®—æ³•å³æ˜¯å¼•ç”¨è®¡æ•°(Reference Counting)ï¼Œå³æ¸…é™¤æ‰€æœ‰é›¶å¼•ç”¨çš„å¯¹è±¡ï¼š

```js
var o1 = {
  o2: {
    x: 1,
  },
};
// 2 objects are created.
// 'o2' is referenced by 'o1' object as one of its properties.
// None can be garbage-collected

var o3 = o1; // the 'o3' variable is the second thing that
// has a reference to the object pointed by 'o1'.

o1 = 1; // now, the object that was originally in 'o1' has a
// single reference, embodied by the 'o3' variable

var o4 = o3.o2; // reference to 'o2' property of the object.
// This object has now 2 references: one as
// a property.
// The other as the 'o4' variable

o3 = "374"; // The object that was originally in 'o1' has now zero
// references to it.
// It can be garbage-collected.
// However, what was its 'o2' property is still
// referenced by the 'o4' variable, so it cannot be
// freed.

o4 = null; // what was the 'o2' property of the object originally in
// 'o1' has zero references to it.
// It can be garbage collected.
```

ä¸è¿‡è¿™ç§ç®—æ³•å¾€å¾€å—åˆ¶äºå¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå³ä¸¤ä¸ªæ— ç”¨çš„å¯¹è±¡ç›¸äº’å¼•ç”¨ï¼š

```js
function f() {
  var o1 = {};
  var o2 = {};
  o1.p = o2; // o1 references o2
  o2.p = o1; // o2 references o1. This creates a cycle.
}

f();
```

ç¨ä¸ºå¤æ‚çš„ç®—æ³•å³æ˜¯æ‰€è°“çš„æ ‡è®°-æ¸…é™¤(Mark-Sweep)ç®—æ³•ï¼Œå…¶æ ¹æ®æŸä¸ªå¯¹è±¡æ˜¯å¦å¯è¾¾æ¥åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦å¯ç”¨ã€‚æ ‡è®°-æ¸…é™¤ç®—æ³•ä¼šä»æŸä¸ªæ ¹å…ƒç´ å¼€å§‹ï¼Œè­¬å¦‚ window å¯¹è±¡å¼€å§‹ï¼Œæ²¿ç€å¼•ç”¨æ ‘å‘ä¸‹éå†ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ä¸ºå¯ç”¨ï¼Œå¹¶ä¸”æ¸…é™¤å…¶ä»–æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚

2012 å¹´ä¹‹åï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸»æµæµè§ˆå™¨éƒ½å®è·µäº†åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ï¼Œå¹¶ä¸”å„è‡ªä¹Ÿè¿›è¡Œæœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–ã€‚

# å†…å­˜æ³„æ¼

æ‰€è°“çš„å†…å­˜æ³„æ¼ï¼Œå³æ˜¯æŒ‡æŸä¸ªå¯¹è±¡è¢«æ— æ„é—´æ·»åŠ äº†æŸæ¡å¼•ç”¨ï¼Œå¯¼è‡´è™½ç„¶å®é™…ä¸Šå¹¶ä¸éœ€è¦äº†ï¼Œä½†è¿˜æ˜¯èƒ½ä¸€ç›´è¢«éå†å¯è¾¾ï¼Œä»¥è‡´å…¶å†…å­˜å§‹ç»ˆæ— æ³•å›æ”¶ã€‚æœ¬éƒ¨åˆ†æˆ‘ä»¬ç®€è¦è®¨è®ºä¸‹ JavaScript ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æƒ…å¢ƒä¸å¤„ç†æ–¹æ³•ã€‚åœ¨æ–°ç‰ˆæœ¬çš„ Chrome ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Performance Monitor æ¥åŠ¨æ€ç›‘æµ‹ç½‘é¡µæ€§èƒ½çš„å˜åŒ–ï¼š

ä¸Šå›¾ä¸­å„é¡¹æŒ‡æ ‡çš„å«ä¹‰ä¸ºï¼š

- **CPU usage -** å½“å‰ç«™ç‚¹çš„ CPU ä½¿ç”¨é‡ï¼›
- **JS heap size -** åº”ç”¨çš„å†…å­˜å ç”¨é‡ï¼›
- **DOM Nodes -** å†…å­˜ä¸­ DOM èŠ‚ç‚¹æ•°ç›®ï¼›
- **JS event listeners-** å½“å‰é¡µé¢ä¸Šæ³¨å†Œçš„ JavaScript æ—¶é—´ç›‘å¬å™¨æ•°ç›®;
- **Documents -** å½“å‰é¡µé¢ä¸­ä½¿ç”¨çš„æ ·å¼æˆ–è€…è„šæœ¬æ–‡ä»¶æ•°ç›®ï¼›
- **Frames -** å½“å‰é¡µé¢ä¸Šçš„ Frames æ•°ç›®ï¼ŒåŒ…æ‹¬ iframe ä¸ workersï¼›
- **Layouts / sec -** æ¯ç§’çš„ DOM é‡å¸ƒå±€æ•°ç›®ï¼›
- **Style recalcs / sec -** æµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—æ ·å¼çš„é¢‘æ¬¡ï¼›

å½“å‘ç°æŸä¸ªæ—¶é—´ç‚¹å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Memory æ ‡ç­¾é¡µå°†æ­¤æ—¶çš„å †åˆ†é…æƒ…å†µæ‰“å°ä¸‹æ¥ï¼š

![Memory Snapshot Take heap snapshot](https://coding.net/u/hoteam/p/Cache/git/raw/master/2017/10/1/MemorySnapshotTakeheapsnapshot.png)

![Memory Snapshot ç»“æœ](https://coding.net/u/hoteam/p/Cache/git/raw/master/2017/10/1/WX20171102-234728.png)

## å…¨å±€å˜é‡

JavaScript ä¼šå°†æ‰€æœ‰çš„ä¸ºå£°æ˜çš„å˜é‡å½“åšå…¨å±€å˜é‡è¿›è¡Œå¤„ç†ï¼Œå³å°†å…¶æŒ‚è½½åˆ° global å¯¹è±¡ä¸Šï¼›æµè§ˆå™¨ä¸­è¿™é‡Œçš„ global å¯¹è±¡å°±æ˜¯ window:

```js
function foo(arg) {
  bar = "some text";
}

// ç­‰ä»·äº

function foo(arg) {
  window.bar = "some text";
}
```

å¦ä¸€ç§å¸¸è§çš„åˆ›å»ºå…¨å±€å˜é‡çš„æ–¹å¼å°±æ˜¯è¯¯ç”¨ `this` æŒ‡é’ˆï¼š

```js
function foo() {
  this.var1 = "potential accidental global";
}
// Foo called on its own, this points to the global object (window)
// rather than being undefined.
foo();
```

ä¸€æ—¦æŸä¸ªå˜é‡è¢«æŒ‚è½½åˆ°äº† window å¯¹è±¡ï¼Œå°±æ„å‘³ç€å®ƒæ°¸è¿œæ˜¯å¯è¾¾çš„ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°æ·»åŠ  `use strict` æˆ–è€…è¿›è¡Œæ¨¡å—åŒ–ç¼–ç (å‚è€ƒ [JavaScript æ¨¡å—æ¼”åŒ–ç®€å²](https://parg.co/Uc2))ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰©å±•ç±»ä¼¼äºä¸‹æ–‡çš„æ‰«æå‡½æ•°ï¼Œæ¥æ£€æµ‹å‡º window å¯¹è±¡çš„éåŸç”Ÿå±æ€§ï¼Œå¹¶åŠ ä»¥åˆ¤æ–­ï¼š

```js
function scan(o) {
  Object.keys(o).forEach(function (key) {
    var val = o[key];

    // Stop if object was created in another window
    if (
      typeof val !== "string" &&
      typeof val !== "number" &&
      typeof val !== "boolean" &&
      !(val instanceof Object)
    ) {
      debugger;
      console.log(key);
    }

    // Traverse the nested object hierarchy
  });
}
```

## å®šæ—¶å™¨ä¸é—­åŒ…

æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ `setInterval` æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå¾ˆå¤šçš„æ¡†æ¶ä¹Ÿæä¾›äº†åŸºäºå›è°ƒçš„å¼‚æ­¥æ‰§è¡Œæœºåˆ¶ï¼›è¿™å¯èƒ½ä¼šå¯¼è‡´å›è°ƒä¸­å£°æ˜äº†å¯¹äºæŸä¸ªå˜é‡çš„ä¾èµ–ï¼Œè­¬å¦‚ï¼š

```js
var serverData = loadData();
setInterval(function () {
  var renderer = document.getElementById("renderer");
  if (renderer) {
    renderer.innerHTML = JSON.stringify(serverData);
  }
}, 5000); //This will be executed every ~5 seconds.
```

å®šæ—¶å™¨ä¿æœ‰å¯¹äº serverData å˜é‡çš„å¼•ç”¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨æ¸…é™¤å®šæ—¶å™¨è¯ï¼Œé‚£ä¹ˆè¯¥å˜é‡ä¹Ÿå°±ä¼šä¸€ç›´å¯è¾¾ï¼Œä¸è¢«å›æ”¶ã€‚è€Œè¿™é‡Œçš„ serverData ä¹Ÿæ˜¯é—­åŒ…å½¢å¼è¢«å¼•å…¥åˆ° setInterval çš„å›è°ƒä½œç”¨åŸŸä¸­ï¼›é—­åŒ…ä¹Ÿæ˜¯å¸¸è§çš„å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„å…ƒå‡¶ä¹‹ä¸€ï¼š

```js
var theThing = null;
var replaceThing = function () {
  var originalThing = theThing;
  var unused = function () {
    if (originalThing)
      // a reference to 'originalThing'
      console.log("hi");
  };
  theThing = {
    longStr: new Array(1000000).join("*"),
    someMethod: function () {
      console.log("message");
    },
  };
};
setInterval(replaceThing, 1000);
```

```js
function sayHi() {
  var allNames = [];
  return (name) => {
    allNames.push(name);
    return "ğŸ‘‹ " + name;
  };
}

var hello = sayHi();

for (var i = 0; i < 1000000; i++) {
  hello("Gandhi");
}
```

ä¸Šè¿°ä»£ç ä¸­ replaceThing ä¼šå®šæœŸæ‰§è¡Œï¼Œå¹¶ä¸”åˆ›å»ºå¤§çš„æ•°ç»„ä¸ someMethod é—­åŒ…èµ‹å€¼ç»™ theThingã€‚someMethod ä½œç”¨åŸŸæ˜¯ä¸ unused å…±äº«çš„ï¼Œunused åˆæœ‰ä¸€ä¸ªæŒ‡å‘ originalThing çš„å¼•ç”¨ã€‚å°½ç®¡ unused å¹¶æœªè¢«å®é™…ä½¿ç”¨ï¼ŒtheThing çš„ someMethod æ–¹æ³•å´æœ‰å¯èƒ½ä¼šè¢«å¤–éƒ¨ä½¿ç”¨ï¼Œä¹Ÿå°±å¯¼è‡´äº† unused å§‹ç»ˆå¤„äºå¯è¾¾çŠ¶æ€ã€‚unused åˆä¼šåå‘ä¾èµ–äº theThingï¼Œæœ€ç»ˆå¯¼è‡´å¤§æ•°ç»„å§‹ç»ˆæ— æ³•è¢«æ¸…é™¤ã€‚

## DOM å¼•ç”¨ä¸ç›‘å¬å™¨

æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šå°† DOM å…ƒç´ å­˜æ”¾åˆ°æ•°æ®ç»“æ„ä¸­ï¼Œè­¬å¦‚å½“æˆ‘ä»¬éœ€è¦é¢‘ç¹æ›´æ–°æŸä¸ªæ•°æ®åˆ—è¡¨æ—¶ï¼Œå¯èƒ½ä¼šå°†ç”¨åˆ°çš„æ•°æ®åˆ—è¡¨å­˜æ”¾åœ¨ JavaScript æ•°ç»„ä¸­ï¼›è¿™ä¹Ÿå°±å¯¼è‡´äº†æ¯ä¸ª DOM å…ƒç´ å­˜åœ¨äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œåˆ†åˆ«åœ¨ DOM æ ‘ä¸ JavaScript æ•°ç»„ä¸­ï¼š

```js
var elements = {
  button: document.getElementById("button"),
  image: document.getElementById("image"),
};
function doStuff() {
  elements.image.src = "http://example.com/image_name.png";
}
function removeImage() {
  // The image is a direct child of the body element.
  document.body.removeChild(document.getElementById("image"));
  // At this point, we still have a reference to #button in the
  //global elements object. In other words, the button element is
  //still in memory and cannot be collected by the GC.
}
```

æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦å°† DOM æ ‘ä¸ JavaScript æ•°ç»„ä¸­çš„å¼•ç”¨çš†åˆ é™¤ï¼Œæ‰èƒ½çœŸå®åœ°æ¸…é™¤è¯¥å¯¹è±¡ã€‚ç±»ä¼¼çš„ï¼Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ¸…é™¤æŸä¸ª DOM å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆç§»é™¤å…¶ç›‘å¬å™¨ï¼Œå¦åˆ™æµè§ˆå™¨å¹¶ä¸ä¼šè‡ªåŠ¨åœ°å¸®æˆ‘ä»¬æ¸…é™¤è¯¥ç›‘å¬å™¨ï¼Œæˆ–è€…å›æ”¶è¯¥ç›‘å¬å™¨å¼•ç”¨çš„å¯¹è±¡ï¼š

```js
var element = document.getElementById("launch-button");
var counter = 0;
function onClick(event) {
  counter++;
  element.innerHtml = "text " + counter;
}
element.addEventListener("click", onClick);
// Do stuff
element.removeEventListener("click", onClick);
element.parentNode.removeChild(element);
// Now when element goes out of scope,
// both element and onClick will be collected even in old browsers // that don't handle cycles well.
```

ç°ä»£æµè§ˆå™¨ä½¿ç”¨çš„ç°ä»£åƒåœ¾å›æ”¶å™¨åˆ™ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åœ°æ£€æµ‹è¿™ç§å¾ªç¯ä¾èµ–ï¼Œå¹¶ä¸”äºˆä»¥æ¸…é™¤ï¼›jQuery ç­‰ç¬¬ä¸‰æ–¹åº“ä¹Ÿä¼šåœ¨æ¸…é™¤å…ƒç´ ä¹‹å‰é¦–å…ˆç§»é™¤å…¶ç›‘å¬äº‹ä»¶ã€‚

## iframe

iframe æ˜¯å¸¸è§çš„ç•Œé¢å…±äº«æ–¹å¼ï¼Œä¸è¿‡å¦‚æœæˆ‘ä»¬åœ¨çˆ¶ç•Œé¢æˆ–è€…å­ç•Œé¢ä¸­æ·»åŠ äº†å¯¹äºçˆ¶ç•Œé¢æŸå¯¹è±¡çš„å¼•ç”¨ï¼Œè­¬å¦‚ï¼š

```js
// å­é¡µé¢å†…
window.top.innerObject = someInsideObject
window.top.document.addEventLister(â€˜clickâ€™, function() { â€¦ });

// å¤–éƒ¨é¡µé¢
 innerObject = iframeEl.contentWindow.someInsideObject
```

å°±æœ‰å¯èƒ½å¯¼è‡´ iframe å¸è½½(ç§»é™¤å…ƒç´ )ä¹‹åä»ç„¶æœ‰éƒ¨åˆ†å¯¹è±¡ä¿ç•™ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç§»é™¤ iframe ä¹‹å‰æ‰§è¡Œå¼ºåˆ¶çš„é¡µé¢é‡è½½ï¼š

```js
<a href="#">Remove</a>
<iframe src="url" />

$('a').click(function(){
    $('iframe')[0].contentWindow.location.reload();
    // çº¿ä¸Šç¯å¢ƒå®æµ‹é‡ç½® src æ•ˆæœä¼šæ›´å¥½
    // $('iframe')[0].src = "javascript:false";
    setTimeout(function(){
       $('iframe').remove();
    }, 1000);
});
```

æˆ–è€…æ‰‹åŠ¨åœ°æ‰§è¡Œé¡µé¢æ¸…é™¤æ“ä½œï¼š

```js
window.onbeforeunload = function(){
    $(document).unbind().die();    //remove listeners on document
    $(document).find('*').unbind().die(); //remove listeners on all nodes
    //clean up cookies
    /remove items from localStorage
}
```

## Web Worker

ç°ä»£æµè§ˆå™¨ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ Web Worker æ¥è¿è¡Œåå°ä»»åŠ¡ï¼Œä¸è¿‡æœ‰æ—¶å€™å¦‚æœæˆ‘ä»¬è¿‡äºé¢‘ç¹ä¸”ä¸åŠ å®¹é”™åœ°åœ¨ä¸»çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼š

```js
function send() {
  setInterval(function () {
    const data = {
      array1: get100Arrays(),
      array2: get500Arrays(),
    };

    let json = JSON.stringify(data);
    let arbfr = str2ab(json);
    worker.postMessage(arbfr, [arbfr]);
  }, 10);
}

function str2ab(str) {
  var buf = new ArrayBuffer(str.length * 2); // 2 bytes for each char
  var bufView = new Uint16Array(buf);
  for (var i = 0, strLen = str.length; i < strLen; i++) {
    bufView[i] = str.charCodeAt(i);
  }
  return buf;
}
```

åœ¨å®é™…çš„ä»£ç ä¸­æˆ‘ä»¬åº”è¯¥æ£€æµ‹ Transferable Objects æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```js
let ab = new ArrayBuffer(1);

try {
  worker.postMessage(ab, [ab]);

  if (ab.byteLength) {
    console.log("TRANSFERABLE OBJECTS are not supported in your browser!");
  } else {
    console.log("USING TRANSFERABLE OBJECTS");
  }
} catch (e) {
  console.log("TRANSFERABLE OBJECTS are not supported in your browser!");
}
```
